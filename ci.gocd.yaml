---
#ci.gocd.yaml
# See: https://github.com/tomzo/gocd-yaml-config-plugin
format_version: 2
pipelines:

  develop-drone:
    group: ops-develop
    label_template: "${mygit[:8]}"
    lock_behavior: none
    materials:
      mygit:
        git: https://github.com/packetfield/infra-core.git
        branch: develop

    stages:
      - deps:
          clean_workspace: false
          jobs:
            deps:
              tasks:
               - exec:
                   command: /bin/bash
                   arguments:
                    - bin/gocd-helper
                    - deps
      - apply:
          clean_workspace: false
          jobs:
            apply:
              tasks:
               - exec:
                   command: /bin/bash
                   arguments:
                    - bin/gocd-helper
                    - make
                    - ENV=develop
                    - COMPONENT=drone
                    - plan
      - config:
          clean_workspace: false
          jobs:
            config:
              tasks:
               - exec:
                   command: /bin/bash
                   arguments:
                    - bin/gocd-helper
                    - make
                    - ENV=develop
                    - COMPONENT=drone
                    - config
